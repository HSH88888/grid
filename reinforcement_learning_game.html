
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ê°•í™”í•™ìŠµ Grid World ì‹œë®¬ë ˆì´ì…˜</title>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
-webkit-tap-highlight-color: transparent;
}

body {
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
display: flex;
flex-direction: column;
align-items: center;
padding: 10px;
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
min-height: 100vh;
overflow-x: hidden;
}

.container {
background: white;
padding: 20px;
border-radius: 15px;
box-shadow: 0 10px 40px rgba(0,0,0,0.3);
max-width: 100%;
width: 100%;
}

h1 {
color: #333;
text-align: center;
margin-bottom: 5px;
font-size: clamp(18px, 5vw, 28px);
}

.subtitle {
text-align: center;
color: #666;
margin-bottom: 15px;
font-size: clamp(12px, 3vw, 16px);
}

.grid-wrapper {
width: 100%;
overflow-x: auto;
overflow-y: auto;
display: flex;
justify-content: center;
margin: 15px 0;
-webkit-overflow-scrolling: touch;
}

#grid {
display: grid;
gap: 1px;
background: #333;
padding: 1px;
border-radius: 6px;
box-shadow: 0 4px 15px rgba(0,0,0,0.2);
margin: 0 auto;
}

.cell {
width: var(--cell-size);
height: var(--cell-size);
display: flex;
align-items: center;
justify-content: center;
font-size: var(--emoji-size);
background: white;
transition: background 0.2s;
position: relative;
user-select: none;
}

.cell.agent {
background: #4CAF50;
color: white;
}

.cell.goal {
background: #FFD700;
}

.cell.obstacle {
background: #f44336;
}

.cell.visited {
background: #E3F2FD;
}

/* Qê°’ í‘œì‹œ */
.q-value {
position: absolute;
font-size: var(--q-font-size);
color: #1976D2;
font-weight: bold;
background: rgba(255, 255, 255, 0.8);
padding: 1px 2px;
border-radius: 2px;
}

.q-up { 
top: 2px; 
left: 50%; 
transform: translateX(-50%); 
}

.q-down { 
bottom: 2px; 
left: 50%; 
transform: translateX(-50%); 
}

.q-left { 
left: 2px; 
top: 50%; 
transform: translateY(-50%); 
}

.q-right { 
right: 2px; 
top: 50%; 
transform: translateY(-50%); 
}

.controls {
display: flex;
gap: 8px;
justify-content: center;
margin: 15px 0;
flex-wrap: wrap;
}

button {
padding: 10px 20px;
font-size: clamp(12px, 3vw, 16px);
cursor: pointer;
border: none;
border-radius: 6px;
background: #667eea;
color: white;
transition: all 0.3s;
font-weight: 600;
white-space: nowrap;
}

button:hover {
background: #5568d3;
transform: translateY(-2px);
box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

button:disabled {
background: #ccc;
cursor: not-allowed;
transform: none;
}

button:active {
transform: translateY(0);
}

button.active {
background: #4CAF50;
}

.stats {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
gap: 10px;
margin: 15px 0;
}

.stat-box {
background: #f5f5f5;
padding: 12px;
border-radius: 8px;
text-align: center;
}

.stat-label {
color: #666;
font-size: clamp(11px, 2.5vw, 14px);
margin-bottom: 3px;
}

.stat-value {
color: #333;
font-size: clamp(18px, 5vw, 24px);
font-weight: bold;
}

.info {
background: #e3f2fd;
padding: 12px;
border-radius: 8px;
margin: 12px 0;
border-left: 4px solid #2196F3;
font-size: clamp(11px, 2.5vw, 14px);
line-height: 1.5;
}

.legend {
display: flex;
gap: 12px;
justify-content: center;
margin: 12px 0;
flex-wrap: wrap;
}

.legend-item {
display: flex;
align-items: center;
gap: 6px;
font-size: clamp(11px, 2.5vw, 14px);
}

.legend-box {
width: clamp(20px, 5vw, 30px);
height: clamp(20px, 5vw, 30px);
border-radius: 4px;
border: 2px solid #333;
flex-shrink: 0;
}

.speed-control {
display: flex;
align-items: center;
gap: 8px;
justify-content: center;
margin: 12px 0;
flex-wrap: wrap;
font-size: clamp(12px, 3vw, 14px);
}

input[type="range"] {
width: clamp(150px, 40vw, 200px);
}

.grid-settings {
background: #f5f5f5;
padding: 12px;
border-radius: 8px;
margin: 12px 0;
}

.grid-size-buttons {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
gap: 6px;
margin: 10px 0;
}

.grid-size-buttons button {
padding: 8px 12px;
font-size: clamp(11px, 2.5vw, 14px);
}

.obstacle-settings {
background: #fff3cd;
padding: 12px;
border-radius: 8px;
margin: 12px 0;
border-left: 4px solid #FF9800;
}

.setting-row {
display: flex;
gap: 8px;
align-items: center;
justify-content: center;
margin: 8px 0;
flex-wrap: wrap;
font-size: clamp(12px, 3vw, 14px);
}

select, input[type="number"] {
padding: 6px 10px;
border-radius: 4px;
border: 1px solid #ddd;
font-size: clamp(12px, 3vw, 14px);
}

/* ë°ìŠ¤í¬í†± (1024px ì´ìƒ) */
@media (min-width: 1024px) {
:root {
--cell-size: 50px;
--emoji-size: 22px;
--q-font-size: 8px;
}
.container {
max-width: 1000px;
padding: 30px;
}
}

/* íƒœë¸”ë¦¿ (768px ~ 1023px) */
@media (min-width: 768px) and (max-width: 1023px) {
:root {
--cell-size: 45px;
--emoji-size: 20px;
--q-font-size: 7px;
}
.container {
padding: 20px;
}
}

/* ëª¨ë°”ì¼ ê°€ë¡œ (481px ~ 767px) */
@media (min-width: 481px) and (max-width: 767px) {
:root {
--cell-size: 40px;
--emoji-size: 18px;
--q-font-size: 7px;
}
.container {
padding: 15px;
}
}

/* ëª¨ë°”ì¼ ì„¸ë¡œ (~ 480px) */
@media (max-width: 480px) {
:root {
--cell-size: 35px;
--emoji-size: 16px;
--q-font-size: 6px;
}
.container {
padding: 12px;
}
body {
padding: 5px;
}
}

/* ì‘ì€ ëª¨ë°”ì¼ (~ 360px) */
@media (max-width: 360px) {
:root {
--cell-size: 30px;
--emoji-size: 14px;
--q-font-size: 5px;
}
.container {
padding: 10px;
}
}

/* í° ê·¸ë¦¬ë“œ ìë™ ì¡°ì • */
@media (max-width: 768px) {
#grid.large-grid {
--cell-size: 28px !important;
--emoji-size: 13px !important;
--q-font-size: 5px !important;
}
}

@media (max-width: 480px) {
#grid.large-grid {
--cell-size: 22px !important;
--emoji-size: 11px !important;
--q-font-size: 4px !important;
}
}
</style>
</head>
<body>
<div class="container">
<h1>ğŸ¤– ê°•í™”í•™ìŠµ Grid World</h1>
<p class="subtitle">Q-Learning ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ì—ì´ì „íŠ¸ê°€ ëª©í‘œë¥¼ ì°¾ëŠ” ê³¼ì •ì„ ì‹œë®¬ë ˆì´ì…˜í•©ë‹ˆë‹¤</p>

<div class="grid-settings">
<div class="setting-row">
<strong>ê·¸ë¦¬ë“œ í¬ê¸°:</strong>
</div>
<div class="grid-size-buttons">
<button onclick="changeGridSize(6)">6Ã—6</button>
<button onclick="changeGridSize(8)">8Ã—8</button>
<button onclick="changeGridSize(10)">10Ã—10</button>
<button onclick="changeGridSize(12)">12Ã—12</button>
<button onclick="changeGridSize(15)">15Ã—15</button>
<button onclick="changeGridSize(20)">20Ã—20</button>
</div>
</div>

<div class="obstacle-settings">
<div class="setting-row">
<strong>ğŸ² ëœë¤ ì¥ì• ë¬¼:</strong>
<select id="obstacleCount">
<option value="5">5ê°œ</option>
<option value="10" selected>10ê°œ</option>
<option value="15">15ê°œ</option>
<option value="20">20ê°œ</option>
<option value="30">30ê°œ</option>
</select>
<button onclick="generateRandomObstacles()" style="background: #FF9800;">ìƒì„±</button>
<button onclick="clearObstacles()" style="background: #f44336;">ì œê±°</button>
</div>
</div>

<div class="legend">
<div class="legend-item">
<div class="legend-box" style="background: #4CAF50;"></div>
<span>ì—ì´ì „íŠ¸</span>
</div>
<div class="legend-item">
<div class="legend-box" style="background: #FFD700;"></div>
<span>ëª©í‘œ</span>
</div>
<div class="legend-item">
<div class="legend-box" style="background: #f44336;"></div>
<span>ì¥ì• ë¬¼</span>
</div>
<div class="legend-item">
<div class="legend-box" style="background: #E3F2FD;"></div>
<span>ê²½ë¡œ</span>
</div>
</div>

<div class="grid-wrapper">
<div id="grid"></div>
</div>

<div class="stats">
<div class="stat-box">
<div class="stat-label">ì—í”¼ì†Œë“œ</div>
<div class="stat-value" id="episode">0</div>
</div>
<div class="stat-box">
<div class="stat-label">ìŠ¤í…</div>
<div class="stat-value" id="steps">0</div>
</div>
<div class="stat-box">
<div class="stat-label">ì´ ë³´ìƒ</div>
<div class="stat-value" id="reward">0</div>
</div>
<div class="stat-box">
<div class="stat-label">ì„±ê³µë¥ </div>
<div class="stat-value" id="success">0%</div>
</div>
</div>

<div class="speed-control">
<label for="speed">ì†ë„:</label>
<input type="range" id="speed" min="1" max="100" value="50">
<span id="speedValue">50ms</span>
</div>

<div class="controls">
<button id="trainBtn" onclick="startTraining()">ğŸ“ í•™ìŠµ</button>
<button id="stopBtn" onclick="stopTraining()" disabled>â¸ï¸ ì •ì§€</button>
<button id="resetBtn" onclick="resetEnvironment()">ğŸ”„ ì´ˆê¸°í™”</button>
<button id="testBtn" onclick="testAgent()">ğŸ¯ í…ŒìŠ¤íŠ¸</button>
<button id="qBtn" onclick="toggleQValues()">ğŸ“Š Qê°’</button>
</div>

<div class="info">
<strong>ğŸ“š ì‘ë™ ì›ë¦¬:</strong><br>
â€¢ <strong>Q-Learning</strong>: ì—ì´ì „íŠ¸ê°€ ìƒíƒœ-í–‰ë™ ê°€ì¹˜ë¥¼ í•™ìŠµ<br>
â€¢ <strong>íƒí—˜ vs í™œìš©</strong>: Îµ-greedy ì „ëµ ì‚¬ìš©<br>
â€¢ <strong>ë³´ìƒ</strong>: ëª©í‘œ +100, ì¥ì• ë¬¼ -100, ìŠ¤í… -1<br>
â€¢ <strong>íŒŒë¼ë¯¸í„°</strong>: í•™ìŠµë¥  0.1, í• ì¸ìœ¨ 0.9, íƒí—˜ìœ¨ 0.1<br>
â€¢ <strong>Qê°’ í‘œì‹œ</strong>: ê° ë°©í–¥(â†‘â†“â†â†’)ì˜ ê¸°ëŒ€ ë³´ìƒ
</div>
</div>

<script>
let GRID_SIZE = 6;
const ACTIONS = ['up', 'down', 'left', 'right'];
let qTable = {};
let agent = { x: 0, y: 0 };
let goal = { x: 5, y: 5 };
let obstacles = [
{ x: 1, y: 1 }, { x: 2, y: 2 }, { x: 3, y: 1 },
{ x: 1, y: 3 }, { x: 4, y: 3 }
];
let episode = 0;
let steps = 0;
let totalReward = 0;
let successCount = 0;
let isTraining = false;
let currentStepInterval = null;
let visitedCells = new Set();
let showQValues = false;

const alpha = 0.1;
const gamma = 0.9;
let epsilon = 0.1;

function changeGridSize(size) {
GRID_SIZE = size;
goal = { x: size - 1, y: size - 1 };
generateRandomObstacles();
resetEnvironment();
}

function generateRandomObstacles() {
const count = parseInt(document.getElementById('obstacleCount').value);
obstacles = [];

for (let i = 0; i < count; i++) {
let x, y;
let attempts = 0;
do {
x = Math.floor(Math.random() * GRID_SIZE);
y = Math.floor(Math.random() * GRID_SIZE);
attempts++;
} while (
attempts < 100 && (
(x === 0 && y === 0) ||
(x === goal.x && y === goal.y) ||
obstacles.some(obs => obs.x === x && obs.y === y)
)
);
if (attempts < 100) {
obstacles.push({ x, y });
}
}
initGrid();
updateDisplay();
}

function clearObstacles() {
obstacles = [];
initGrid();
updateDisplay();
}

function toggleQValues() {
showQValues = !showQValues;
const btn = document.getElementById('qBtn');
if (showQValues) {
btn.classList.add('active');
btn.textContent = 'ğŸ“Š Qê°’âœ“';
} else {
btn.classList.remove('active');
btn.textContent = 'ğŸ“Š Qê°’';
}
updateDisplay();
}

function initGrid() {
const grid = document.getElementById('grid');
grid.style.gridTemplateColumns = `repeat(${GRID_SIZE}, var(--cell-size))`;
grid.innerHTML = '';

// í° ê·¸ë¦¬ë“œ í‘œì‹œ
if (GRID_SIZE > 12) {
grid.classList.add('large-grid');
} else {
grid.classList.remove('large-grid');
}

for (let y = 0; y < GRID_SIZE; y++) {
for (let x = 0; x < GRID_SIZE; x++) {
const cell = document.createElement('div');
cell.className = 'cell';
cell.id = `cell-${x}-${y}`;

if (x === agent.x && y === agent.y) {
cell.classList.add('agent');
cell.textContent = 'ğŸ¤–';
} else if (x === goal.x && y === goal.y) {
cell.classList.add('goal');
cell.textContent = 'ğŸ¯';
} else if (obstacles.some(obs => obs.x === x && obs.y === y)) {
cell.classList.add('obstacle');
cell.textContent = 'ğŸš«';
}

grid.appendChild(cell);
}
}
}

function getStateKey(x, y) {
return `${x},${y}`;
}

function getQValue(state, action) {
const key = `${state}-${action}`;
return qTable[key] || 0;
}

function setQValue(state, action, value) {
const key = `${state}-${action}`;
qTable[key] = value;
}

function chooseAction(state) {
if (Math.random() < epsilon) {
return ACTIONS[Math.floor(Math.random() * ACTIONS.length)];
}

let bestAction = ACTIONS[0];
let bestValue = getQValue(state, bestAction);

for (let action of ACTIONS) {
const value = getQValue(state, action);
if (value > bestValue) {
bestValue = value;
bestAction = action;
}
}
return bestAction;
}

function takeAction(action) {
let newX = agent.x;
let newY = agent.y;

switch(action) {
case 'up': newY = Math.max(0, newY - 1); break;
case 'down': newY = Math.min(GRID_SIZE - 1, newY + 1); break;
case 'left': newX = Math.max(0, newX - 1); break;
case 'right': newX = Math.min(GRID_SIZE - 1, newX + 1); break;
}

let reward = -1;
let done = false;

if (obstacles.some(obs => obs.x === newX && obs.y === newY)) {
reward = -100;
done = true;
} else if (newX === goal.x && newY === goal.y) {
reward = 100;
done = true;
successCount++;
} else {
agent.x = newX;
agent.y = newY;
visitedCells.add(getStateKey(newX, newY));
}

return { newX, newY, reward, done };
}

function updateQValue(state, action, reward, nextState) {
const currentQ = getQValue(state, action);

let maxNextQ = -Infinity;
for (let nextAction of ACTIONS) {
const q = getQValue(nextState, nextAction);
if (q > maxNextQ) maxNextQ = q;
}

const newQ = currentQ + alpha * (reward + gamma * maxNextQ - currentQ);
setQValue(state, action, newQ);
}

function updateDisplay() {
for (let y = 0; y < GRID_SIZE; y++) {
for (let x = 0; x < GRID_SIZE; x++) {
const cell = document.getElementById(`cell-${x}-${y}`);
if (!cell) continue;
cell.className = 'cell';
cell.innerHTML = '';

if (visitedCells.has(getStateKey(x, y))) {
cell.classList.add('visited');
}

if (x === agent.x && y === agent.y) {
cell.classList.add('agent');
const agentEmoji = document.createElement('span');
agentEmoji.textContent = 'ğŸ¤–';
agentEmoji.style.position = 'relative';
agentEmoji.style.zIndex = '2';
cell.appendChild(agentEmoji);
} else if (x === goal.x && y === goal.y) {
cell.classList.add('goal');
cell.textContent = 'ğŸ¯';
} else if (obstacles.some(obs => obs.x === x && obs.y === y)) {
cell.classList.add('obstacle');
cell.textContent = 'ğŸš«';
}

// Qê°’ í‘œì‹œ
if (showQValues && !obstacles.some(obs => obs.x === x && obs.y === y)) {
const state = getStateKey(x, y);

const qUp = getQValue(state, 'up');
const qDown = getQValue(state, 'down');
const qLeft = getQValue(state, 'left');
const qRight = getQValue(state, 'right');

if (qUp !== 0) {
const qDiv = document.createElement('div');
qDiv.className = 'q-value q-up';
qDiv.textContent = qUp.toFixed(1);
cell.appendChild(qDiv);
}
if (qDown !== 0) {
const qDiv = document.createElement('div');
qDiv.className = 'q-value q-down';
qDiv.textContent = qDown.toFixed(1);
cell.appendChild(qDiv);
}
if (qLeft !== 0) {
const qDiv = document.createElement('div');
qDiv.className = 'q-value q-left';
qDiv.textContent = qLeft.toFixed(1);
cell.appendChild(qDiv);
}
if (qRight !== 0) {
const qDiv = document.createElement('div');
qDiv.className = 'q-value q-right';
qDiv.textContent = qRight.toFixed(1);
cell.appendChild(qDiv);
}
}
}
}

document.getElementById('episode').textContent = episode;
document.getElementById('steps').textContent = steps;
document.getElementById('reward').textContent = Math.round(totalReward);
const successRate = episode > 0 ? Math.round((successCount / episode) * 100) : 0;
document.getElementById('success').textContent = successRate + '%';
}

function runEpisode() {
agent.x = 0;
agent.y = 0;
visitedCells.clear();
visitedCells.add(getStateKey(0, 0));

let episodeSteps = 0;
let episodeReward = 0;
const maxSteps = GRID_SIZE * GRID_SIZE * 2;

if (currentStepInterval) {
clearInterval(currentStepInterval);
}

currentStepInterval = setInterval(() => {
const state = getStateKey(agent.x, agent.y);
const action = chooseAction(state);
const result = takeAction(action);

episodeSteps++;
steps++;
episodeReward += result.reward;
totalReward += result.reward;

const nextState = getStateKey(result.newX, result.newY);
updateQValue(state, action, result.reward, nextState);

updateDisplay();

if (result.done || episodeSteps >= maxSteps) {
clearInterval(currentStepInterval);
episode++;
if (isTraining) {
setTimeout(runEpisode, 100);
}
}
}, 101 - document.getElementById('speed').value);

if (!isTraining) {
clearInterval(currentStepInterval);
}
}

function startTraining() {
isTraining = true;
document.getElementById('trainBtn').disabled = true;
document.getElementById('stopBtn').disabled = false;
document.getElementById('testBtn').disabled = true;
epsilon = 0.1;
runEpisode();
}

function stopTraining() {
isTraining = false;
if (currentStepInterval) {
clearInterval(currentStepInterval);
}
document.getElementById('trainBtn').disabled = false;
document.getElementById('stopBtn').disabled = true;
document.getElementById('testBtn').disabled = false;
}

function resetEnvironment() {
stopTraining();
qTable = {};
agent = { x: 0, y: 0 };
episode = 0;
steps = 0;
totalReward = 0;
successCount = 0;
visitedCells.clear();
visitedCells.add(getStateKey(0, 0));
initGrid();
updateDisplay();
}

function testAgent() {
stopTraining();
epsilon = 0;
agent.x = 0;
agent.y = 0;
visitedCells.clear();
runEpisode();
}

document.getElementById('speed').addEventListener('input', (e) => {
document.getElementById('speedValue').textContent = (101 - e.target.value) + 'ms';
});

// ì´ˆê¸°í™”
initGrid();
updateDisplay();
</script>
</body>
</html>
